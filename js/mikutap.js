$(function(){(new MainManager).init()});var MainManager=function(){aidn.util.useDummyDiv();function a(){G=aidn.window.width(),A=aidn.window.height(),I&&(I.resize(G,A),g&&g.resize())}function e(n,a){a=R.length+C.length,1==b&&(n+=C.length);var e=Math.round(n/a*100)+"%";a<=0&&(e="0%"),$("#scene_loading hr").css("width",e)}function t(){1==++b?R.init(t,e):2==b&&i()}function i(){x=1,$("#scene_loading hr").css("display","none"),$("#scene_loading hr").css("width",0),$("#scene_loading").stop().fadeOut(200,"linear"),p?($("#scene_loading").stop().css("display","none"),$("#bt_back").stop().css("display","none"),B&&$("#bt_fs").stop().css("display","none"),$("#scene_main .set").stop().css("display","none")):$("#scene_main").stop().fadeIn(200,"linear"),m=aidn.___waContext.currentTime,g.start(),C.start()}function n(n){(U=!U)?($("#bt_feedback a").text("反馈: 开启"),aidn.util.setCookie("fb","on",2592e3)):($("#bt_feedback a").text("反馈: 关闭"),aidn.util.setCookie("fb","off",2592e3)),n&&n.preventDefault()}function o(n){(T=!T)?($("#bt_backtrack a").text("背景音乐: 开启"),aidn.util.setCookie("bt","on",2592e3)):($("#bt_backtrack a").text("背景音乐: 关闭"),aidn.util.setCookie("bt","off",2592e3)),n&&n.preventDefault()}function r(){C.update(),1==x&&--D<0&&v(),function(){if(!p)return;if(1!=x)return;var n=1e3*(aidn.___waContext.currentTime-m);if(l*s<n){var a=Math.floor(n/s)+1;h+=a-l;var e=(l=a)*s-n;if(0<=e){var t=Math.random(),i=1;192<=h?h=0:128<=h?(t<.7&&(i=2),t<.5&&(i=3)):64<=h?(t<.35&&(i=2),t<.2&&(i=3),t<.02&&(i=0)):32<=h?(t<.35&&(i=2),t<.24&&(i=0)):0<=h&&t<.4&&(i=0);for(var o=0;o<i;o++)d=c[f],32<=++f&&(f=0,aidn.util.shuffleArray(c)),g.changeId(d,0,!0)}}}(),I.render(z),window.requestAnimFrame(r)}this.init=function(){!function(){aidn.window.addDummyDiv();try{aidn.adv.show()}catch(n){}var n=1;2<=window.devicePixelRatio&&(n=2);(I=PIXI.autoDetectRenderer(G,A,{backgroundColor:16756655,antialias:!1,resolution:n})).autoDensity=!0,document.getElementById("view").appendChild(I.view),z=new PIXI.Container,g.init(),a(),$("#scene_top").fadeIn(300),r()}()};for(var l=0,s=6e4/280,d=Math.floor(32*Math.random()),h=0,c=[],f=0,u=0;u<32;u++)c[u]=u;function v(){p||S||(S=!0,$("#bt_back").stop().fadeIn(200,"linear"),B&&$("#bt_fs").stop().fadeIn(200,"linear"),$("#scene_main .set").stop().fadeIn(200,"linear"))}var p=!1;1==aidn.util.getQuery().auto&&(p=!0),aidn.util.needExpandArea(!0);var B=aidn.util.enabledFullscreen();B&&($("#bt_fs").css("display","block"),$("#bt_fs").click(function(n){aidn.util.fullscreen()})),$("#bt_start a").click(function(n){$("#scene_top").stop().fadeOut(200,"linear"),$("#scene_loading").stop().fadeIn(200,"linear"),2==b?i():((new aidn.WebAudio).load(""),C.init(t,e));try{aidn.adv.hide()}catch(n){}n.preventDefault()}),$("#bt_about a").click(function(n){$("#about").stop().fadeIn(200,"linear"),$("#about_cover").stop().fadeIn(200,"linear"),n.preventDefault()}),$("#bt_close,#about_cover").click(function(){$("#about").stop().fadeOut(200,"linear"),$("#about_cover").stop().fadeOut(200,"linear")}),$("#bt_back").click(function(){switch(x){case 1:x=0;try{aidn.adv.show()}catch(n){}g.end(),C.end(),$("#scene_top").stop().fadeIn(100,"linear"),$("#scene_loading").stop().fadeOut(100,"linear"),$("#scene_main").stop().fadeOut(100,"linear"),v();break;default:location.href="https://github.com/ANGForever/mikutap/
